---
title: HTTP的缓存控制（透视HTTP协议系列）
date: 2022-01-010 02:46
tags: [HTTP]
categories: [计算机网络]
---

# HTTP的缓存控制（透视HTTP协议系列）

由于链路漫长，网络时延不可控，浏览器使用 HTTP 获取资源的成本较高。所以，非常有
必要把“来之不易”的数据缓存起来，下次再请求的时候尽可能地复用。这样，就可以避免
多次请求 - 应答的通信成本，节约网络带宽，也可以加快响应速度。

缓存分为两种，`客户端缓存`和`服务器缓存`。

## 一、服务器的缓存控制

为了更好地说明缓存的运行机制，下面我用“生鲜速递”作为比喻，看看缓存是如何工作
的。

夏天到了，天气很热。你想吃西瓜消暑，于是打开冰箱，但很不巧，冰箱是空的。不过没
事，现在物流很发达，给生鲜超市打个电话，不一会儿，就给你送来一个 8 斤的沙瓤大西
瓜，上面还贴着标签：“保鲜期 5 天”。好了，你把它放进冰箱，想吃的时候随时拿出
来。

在这个场景里，“生鲜超市”就是 Web 服务器，“你”就是浏览器，“冰箱”就是浏览器
内部的缓存。整个流程翻译成 HTTP 就是：

- 1. 浏览器发现缓存无数据，于是发送请求，向服务器获取资源；
- 2. 服务器响应请求，返回资源，同时标记资源的有效期；
- 3. 浏览器缓存资源，等待下次重用。

![](https://tva1.sinaimg.cn/large/008i3skNgy1gy7rro0t4sj30hx0hkdh4.jpg)

服务器标记资源有效期使用的头字段是“Cache-Control”，里面的值“maxage=30”就是资源的有效时间，相当于告诉浏览器，“这个页面只能缓存 30 秒，之后就算是过期，不能用。”

你可能要问了，让浏览器直接缓存数据就好了，为什么要加个有效期呢？

这是因为网络上的数据随时都在变化，不能保证它稍后的一段时间还是原来的样子。就像生
鲜超市给你快递的西瓜，只有 5 天的保鲜期，过了这个期限最好还是别吃，不然可能会闹
肚子。

## 二、服务器缓存的类型

“max-age”是 HTTP 缓存控制最常用的属性，此外在响应报文里还可以用其他的属性来
更精确地指示浏览器应该如何使用缓存：

- no_store：不允许缓存，用于某些变化非常频繁的数据，例如秒杀页面；
- no_cache：它的字面含义容易与 no_store 搞混，实际的意思并不是不允许缓存，而是
可以缓存，但在使用之前必须要去服务器验证是否过期，是否有最新的版本；
- must-revalidate：又是一个和 no_cache 相似的词，它的意思是如果缓存不过期就可以
继续使用，但过期了如果还想用就必须去服务器验证。

听的有点糊涂吧。没关系，我拿生鲜速递来举例说明一下：

- no_store：买来的西瓜不允许放进冰箱，要么立刻吃，要么立刻扔掉；
- no_cache：可以放进冰箱，但吃之前必须问超市有没有更新鲜的，有就吃超市里的；
- must-revalidate：可以放进冰箱，保鲜期内可以吃，过期了就要问超市让不让吃

![](https://tva1.sinaimg.cn/large/008i3skNgy1gy7rvlgs9dj30ie0o40tl.jpg)






------
**这个公众号会持续更新技术方案、关注业内技术动向，关注一下成本不高，错过干货损失不小。
↓↓↓**
![](https://tva1.sinaimg.cn/large/e6c9d24egy1gzzmv1p67mj21bi0hcwgh.jpg)